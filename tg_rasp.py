import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.filters import Command
from aiogram.fsm.state import StatesGroup, State
from aiogram.fsm.context import FSMContext
from datetime import datetime, timedelta

API_TOKEN = "7548972982:AAH3NLQl1PxhYAcozBLlLfhY6BgY2QOUCMM"


schedule_data_all = [
    # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
    {"–î–µ–Ω—å": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ä–µ–º—è": "15:10", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "425", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ë–ò–õ–¨–ß–ï–ù–ö–û –ù–ê–¢–ê–õ–¨–Ø –ì–†–ò–ì–û–†–¨–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ä–µ–º—è": "16:50", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏–∫–∞", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª.—Ä.",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "303", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–®–ê–†–ò–ü–û–í–ê –ê–õ–ò–ù–ê –ê–õ–¨–ë–ï–†–¢–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –æ–±—â–µ–π —Ñ–∏–∑–∏–∫–∏",
     "–î–∞—Ç—ã": "08.09 22.09 06.10 20.10 03.11 17.11 01.12 15.12"},

    {"–î–µ–Ω—å": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ä–µ–º—è": "16:50", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏–∫–∞", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª.—Ä.",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "303", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ê–ù–î–†–ï–ï–í–ê –ù–ê–¢–ê–õ–¨–Ø –ì–ï–ù–ù–ê–î–¨–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –æ–±—â–µ–π —Ñ–∏–∑–∏–∫–∏",
     "–î–∞—Ç—ã": "08.09 22.09 06.10 20.10 03.11 17.11 01.12 15.12"},

    # –í—Ç–æ—Ä–Ω–∏–∫
    {"–î–µ–Ω—å": "–í—Ç–æ—Ä–Ω–∏–∫", "–í—Ä–µ–º—è": "08:00", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –∏ —Å–ø–æ—Ä—Ç (—ç–ª–µ–∫—Ç–∏–≤–Ω–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞)", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–û–õ–ò–ú–ü4", "–ó–¥–∞–Ω–∏–µ": "–ö–°–ö", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–¨ –ö–ê–§–ï–î–†–´",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã –∏ —Å–ø–æ—Ä—Ç–∞", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–í—Ç–æ—Ä–Ω–∏–∫", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª.—Ä.",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "219–∞", "–ó–¥–∞–Ω–∏–µ": "7", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ú–£–°–¢–ê–§–ê–ï–í –¢–ò–ú–£–† –ê–ó–ò–°–û–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
     "–î–∞—Ç—ã": "02.09 09.09 16.09 23.09 30.09 07.10 14.10 21.10 28.10 11.11 18.11 25.11 02.12 09.12 16.12 30.12"},

    {"–î–µ–Ω—å": "–í—Ç–æ—Ä–Ω–∏–∫", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ –æ—Å–Ω–æ–≤—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª.—Ä.",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "425", "–ó–¥–∞–Ω–∏–µ": "7", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–¢–£–ú–ë–ò–ù–°–ö–ê–Ø –ú–ê–†–ò–ù–ê –í–õ–ê–î–ò–ú–ò–†–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
     "–î–∞—Ç—ã": "02.09 09.09 16.09 23.09 30.09 07.10 14.10 21.10 28.10 11.11 18.11 25.11 02.12 09.12 16.12 30.12"},

    {"–î–µ–Ω—å": "–í—Ç–æ—Ä–Ω–∏–∫", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª.—Ä.",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "219–∞", "–ó–¥–∞–Ω–∏–µ": "7", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ú–£–°–¢–ê–§–ê–ï–í –¢–ò–ú–£–† –ê–ó–ò–°–û–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
     "–î–∞—Ç—ã": "02.09 09.09 16.09 23.09 30.09 07.10 14.10 21.10 28.10 11.11 18.11 25.11 02.12 09.12 16.12 30.12"},

    {"–î–µ–Ω—å": "–í—Ç–æ—Ä–Ω–∏–∫", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ –æ—Å–Ω–æ–≤—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª.—Ä.",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "425", "–ó–¥–∞–Ω–∏–µ": "7", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–¢–£–ú–ë–ò–ù–°–ö–ê–Ø –ú–ê–†–ò–ù–ê –í–õ–ê–î–ò–ú–ò–†–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
     "–î–∞—Ç—ã": "02.09 09.09 16.09 23.09 30.09 07.10 14.10 21.10 28.10 11.11 18.11 25.11 02.12 09.12 16.12 30.12"},

    # –°—Ä–µ–¥–∞
    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "09:40", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "202", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ë–£–õ–ê–®–û–í –î–ú–ò–¢–†–ò–ô –ê–ù–ê–¢–û–õ–¨–ï–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–ª–æ—Å–æ—Ñ–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "404", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–¨ –ö–ê–§–ï–î–†–´",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–û—Å–Ω–æ–≤—ã —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "401", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–°–ò–†–ê–ó–ï–ï–í–ê –¢–ê–õ–ò–Ø –¢–ò–ú–ï–†–•–ê–ù–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "334", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–¨ –ö–ê–§–ï–î–†–´",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "333", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–®–ê–ì–ë–ê–ù–û–í–ê –Æ–õ–ò–Ø –ë–û–†–ò–°–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏, –ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏–∏ –∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "15:10", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "355", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–®–ê–ì–ë–ê–ù–û–í–ê –Æ–õ–ò–Ø –ë–û–†–ò–°–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏, –ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏–∏ –∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "16:50", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–î–û–¢3", "–ó–¥–∞–Ω–∏–µ": "–î–û–¢", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–°–ò–†–ê–ó–ï–¢–î–ò–ù–û–í –†–ò–§–ö–ê–¢ –¢–ê–õ–ì–ê–¢–û–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—Ä–µ–¥–∞", "–í—Ä–µ–º—è": "16:50", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "355", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–®–ê–ì–ë–ê–ù–û–í–ê –Æ–õ–ò–Ø –ë–û–†–ò–°–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏, –ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏–∏ –∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞", "–î–Ω–∏": "—á–µ—Ç"},

    # –ß–µ—Ç–≤–µ—Ä–≥
    {"–î–µ–Ω—å": "–ß–µ—Ç–≤–µ—Ä–≥", "–í—Ä–µ–º—è": "08:00", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–ª–æ—Å–æ—Ñ–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "333", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ü–ï–¢–†–û–í–ê –ù–ê–¢–ê–õ–¨–Ø –ù–ò–ö–û–õ–ê–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–ß–µ—Ç–≤–µ—Ä–≥", "–í—Ä–µ–º—è": "09:40", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏–∫–∞", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–∞–∫—Ç–æ–≤—ã–π –∑–∞–ª", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ê–°–ê–î–£–õ–õ–ò–ù–ê –ù–ê–ò–õ–Ø –Ø–°–ê–í–ò–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –æ–±—â–µ–π —Ñ–∏–∑–∏–∫–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–ß–µ—Ç–≤–µ—Ä–≥", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏–∫–∞", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "304", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ê–°–ê–î–£–õ–õ–ò–ù–ê –ù–ê–ò–õ–Ø –Ø–°–ê–í–ò–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –æ–±—â–µ–π —Ñ–∏–∑–∏–∫–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–ß–µ—Ç–≤–µ—Ä–≥", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "506", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ë–£–õ–ê–®–û–í –î–ú–ò–¢–†–ò–ô –ê–ù–ê–¢–û–õ–¨–ï–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–ß–µ—Ç–≤–µ—Ä–≥", "–í—Ä–µ–º—è": "15:10", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "506", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ë–ò–õ–¨–ß–ï–ù–ö–û –ù–ê–¢–ê–õ–¨–Ø –ì–†–ò–ì–û–†–¨–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "—á–µ—Ç"},

    # –ü—è—Ç–Ω–∏—Ü–∞
    {"–î–µ–Ω—å": "–ü—è—Ç–Ω–∏—Ü–∞", "–í—Ä–µ–º—è": "08:00", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –∏ —Å–ø–æ—Ä—Ç (—ç–ª–µ–∫—Ç–∏–≤–Ω–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞)", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–û–õ–ò–ú–ü4", "–ó–¥–∞–Ω–∏–µ": "–ö–°–ö", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–¨ –ö–ê–§–ï–î–†–´",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã –∏ —Å–ø–æ—Ä—Ç–∞"},

    {"–î–µ–Ω—å": "–ü—è—Ç–Ω–∏—Ü–∞", "–í—Ä–µ–º—è": "09:40", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "506", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–¢–£–ö–¢–ê–†–û–í–ê –ì–£–ó–ï–õ–¨ –ú–ê–ù–°–£–†–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤, —Ä—É—Å—Å–∫–æ–≥–æ –∏ —Ä—É—Å—Å–∫–æ–≥–æ –∫–∞–∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ"},

    {"–î–µ–Ω—å": "–ü—è—Ç–Ω–∏—Ü–∞", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "506", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–¢–£–ö–¢–ê–†–û–í–ê –ì–£–ó–ï–õ–¨ –ú–ê–ù–°–£–†–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤, —Ä—É—Å—Å–∫–æ–≥–æ –∏ —Ä—É—Å—Å–∫–æ–≥–æ –∫–∞–∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–ü—è—Ç–Ω–∏—Ü–∞", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–∞–∫—Ç–æ–≤—ã–π –∑–∞–ª", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ú–ò–†–û–ù–û–í–ê –°–í–ï–¢–õ–ê–ù–ê –†–ê–§–ê–ò–õ–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–ü—è—Ç–Ω–∏—Ü–∞", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ –æ—Å–Ω–æ–≤—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "419", "–ó–¥–∞–Ω–∏–µ": "7", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–¢–£–ú–ë–ò–ù–°–ö–ê–Ø –ú–ê–†–ò–ù–ê –í–õ–ê–î–ò–ú–ò–†–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–î–Ω–∏": "–Ω–µ—á"},

    # –°—É–±–±–æ—Ç–∞
    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "08:00", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–ª–æ—Å–æ—Ñ–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "333", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ü–ï–¢–†–û–í–ê –ù–ê–¢–ê–õ–¨–Ø –ù–ò–ö–û–õ–ê–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "08:00", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "300", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ú–ò–†–û–ù–û–í–ê –°–í–ï–¢–õ–ê–ù–ê –†–ê–§–ê–ò–õ–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "09:40", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "530", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–õ–ï–û–ù–û–í –ò–ì–û–†–¨ –í–ò–ö–¢–û–†–û–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏, –ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏–∏ –∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "09:40", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–û—Å–Ω–æ–≤—ã —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–õ–ó ‚Ññ3", "–ó–¥–∞–Ω–∏–µ": "2", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–°–ò–†–ê–ó–ï–ï–í–ê –¢–ê–õ–ò–Ø –¢–ò–ú–ï–†–•–ê–ù–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ø—Ä",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "338", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ë–ò–õ–¨–ß–ï–ù–ö–û –ù–ê–¢–ê–õ–¨–Ø –ì–†–ò–ì–û–†–¨–ï–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "–Ω–µ—á"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "11:20", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–û—Å–Ω–æ–≤—ã —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "333", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–°–ò–†–ê–ó–ï–ï–í–ê –¢–ê–õ–ò–Ø –¢–ò–ú–ï–†–•–ê–ù–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "13:30", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "333", "–ó–¥–∞–Ω–∏–µ": "8", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–®–£–†–´–ì–ò–ù–ê –ú–ê–†–ò–ù–ê –ê–õ–ï–ö–°–ê–ù–î–†–û–í–ù–ê",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–î–Ω–∏": "—á–µ—Ç"},

    {"–î–µ–Ω—å": "–°—É–±–±–æ—Ç–∞", "–í—Ä–µ–º—è": "20:00", "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –∏ —Å–ø–æ—Ä—Ç", "–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è": "–ª–µ–∫",
     "–ê—É–¥–∏—Ç–æ—Ä–∏—è": "–î–û–¢2", "–ó–¥–∞–Ω–∏–µ": "–î–û–¢", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å": "–ì–ê–õ–ò–ú–û–í–ê –≠–õ–¨–ì–ê –í–ò–ö–¢–û–†–û–í–ò–ß",
     "–ö–∞—Ñ–µ–¥—Ä–∞": "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã –∏ —Å–ø–æ—Ä—Ç–∞", "–î–Ω–∏": "–Ω–µ—á"},

]




groupset = "4123"

bot = Bot(token=API_TOKEN)
ADMIN_ID = 1893750503

groupset = "4123"
bot = Bot(token=API_TOKEN)
dp = Dispatcher()

# –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
whitelist = {ADMIN_ID}  # –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω

# –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
kb_main = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="–ü—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è")],
        [KeyboardButton(text="–≠—Ç–∞ –Ω–µ–¥–µ–ª—è")],
        [KeyboardButton(text="–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è")]
    ],
    resize_keyboard=True,
)

# --- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è ---
START_DATE = datetime(2025, 9, 1)
END_DATE = datetime(2025, 12, 30)

# --- –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º ---
def is_even_week(date: datetime) -> bool:
    delta_weeks = ((date - START_DATE).days) // 7
    return delta_weeks % 2 == 1

def filter_schedule(week: str):
    now = datetime.now()
    current_monday = now - timedelta(days=now.weekday())

    if week == "next":
        current_monday += timedelta(weeks=1)
    elif week == "prev":
        current_monday -= timedelta(weeks=1)

    if current_monday + timedelta(days=6) < START_DATE or current_monday > END_DATE:
        return None

    days_map = {"–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫": 0, "–í—Ç–æ—Ä–Ω–∏–∫": 1, "–°—Ä–µ–¥–∞": 2, "–ß–µ—Ç–≤–µ—Ä–≥": 3,
                "–ü—è—Ç–Ω–∏—Ü–∞": 4, "–°—É–±–±–æ—Ç–∞": 5, "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ": 6}

    filtered = []
    for entry in schedule_data_all:
        day_num = days_map.get(entry.get("–î–µ–Ω—å"), -1)
        if day_num == -1:
            continue
        class_date = current_monday + timedelta(days=day_num)

        days_field = entry.get("–î–Ω–∏")
        if days_field == "–Ω–µ—á" and is_even_week(class_date):
            continue
        elif days_field == "—á–µ—Ç" and not is_even_week(class_date):
            continue

        if "–î–∞—Ç—ã" in entry:
            dates_list = entry["–î–∞—Ç—ã"].split()
            str_date = class_date.strftime("%d.%m")
            if str_date not in dates_list:
                continue

        filtered.append((class_date.strftime("%d.%m.%Y"), entry))

    return filtered

def format_schedule_list(entries):
    if not entries:
        return "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ."
    result = ""
    current_day = None
    for date_str, entry in sorted(entries, key=lambda x: (x[0], x[1]["–í—Ä–µ–º—è"])):
        if date_str != current_day:
            result += f"\nüìÜ {date_str}  {entry['–î–µ–Ω—å'].upper()}\n"
            current_day = date_str
        time = entry['–í—Ä–µ–º—è']
        subject = entry['–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞']
        kind = entry.get('–í–∏–¥ –∑–∞–Ω—è—Ç–∏—è', '')
        aud = entry.get('–ê—É–¥–∏—Ç–æ—Ä–∏—è', '')
        building = entry.get('–ó–¥–∞–Ω–∏–µ', '')
        teacher = entry.get('–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', '')
        result += f"{time} | {subject} ({kind}) | –∞—É–¥–∏—Ç–æ—Ä–∏—è {aud}, –∑–¥–∞–Ω–∏–µ {building} | {teacher}\n"
    return result

# --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
def is_allowed(user_id: int) -> bool:
    return user_id in whitelist

# --- –ö–æ–º–∞–Ω–¥–∞ /start ---
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    if not is_allowed(message.from_user.id):
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É.")
        return

    await message.answer(
        f"–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –±–æ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≥—Ä—É–ø–ø—ã {groupset}. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é:",
        reply_markup=kb_main
    )

# --- –ö–æ–º–∞–Ω–¥–∞ –∞–¥–º–∏–Ω–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
@dp.message(Command("add"))
async def add_user(message: types.Message):
    if message.from_user.id != ADMIN_ID:
        await message.answer("‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.")
        return

    args = message.text.split()
    if len(args) != 2:
        await message.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /add <user_id>")
        return

    try:
        new_user_id = int(args[1])
        whitelist.add(new_user_id)
        await message.answer(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {new_user_id} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫.")
    except ValueError:
        await message.answer("‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.")

# --- –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫ ---
@dp.message()
async def main_handler(message: types.Message):
    if not is_allowed(message.from_user.id):
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É.")
        return

    text = message.text.strip()
    if text == "–≠—Ç–∞ –Ω–µ–¥–µ–ª—è":
        sched = filter_schedule("this")
        if sched is None:
            await message.answer("üìõ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏.")
        else:
            await message.answer(format_schedule_list(sched))

    elif text == "–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è":
        sched = filter_schedule("next")
        if sched is None:
            await message.answer("üìõ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏.")
        else:
            await message.answer(format_schedule_list(sched))

    elif text == "–ü—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è":
        sched = filter_schedule("prev")
        if sched is None:
            await message.answer("üìõ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏.")
        else:
            await message.answer(format_schedule_list(sched))

    else:
        await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é –∫–Ω–æ–ø–∫–∞–º–∏ –∏–ª–∏ –≤–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É /start")

# --- –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ ---
async def main():
    await dp.start_polling(bot)

if __name__ == '__main__':
    asyncio.run(main())
